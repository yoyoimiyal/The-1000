<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数独终结者</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .cell {
            width: 34px;
            height: 34px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            border: 1px solid #cbd5e1;
            outline: none;
            color: #1e293b;
        }

        .cell:focus {
            background-color: #e0e7ff;
        }

        .cell.solved {
            color: #2563eb;
        }

        /* Blue for solution */
        .bb-thick {
            border-bottom: 2px solid #475569;
        }

        .br-thick {
            border-right: 2px solid #475569;
        }

        .grid-frame {
            display: grid;
            grid-template-columns: repeat(9, auto);
            width: fit-content;
            border: 2px solid #475569;
        }
    </style>
</head>

<body class="bg-indigo-50 min-h-screen flex flex-col items-center justify-center p-4 text-slate-800">

    <div class="w-full max-w-lg bg-white p-6 rounded-3xl shadow-xl border border-indigo-100 flex flex-col items-center">

        <header class="flex justify-between items-center w-full mb-6">
            <h1 class="text-xl font-bold text-indigo-800">Sudoku Solver</h1>
            <a href="./navigation.html" class="text-xs text-indigo-400 hover:text-indigo-600">退出</a>
        </header>

        <div id="board" class="grid-frame mb-6 bg-white">
            <!-- Cells -->
        </div>

        <div class="flex gap-4 w-full">
            <button onclick="solve()"
                class="flex-1 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl shadow-lg transition">求解
                (Solve)</button>
            <button onclick="reset()"
                class="px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold rounded-xl transition">重置</button>
        </div>

        <button onclick="loadSample()" class="mt-4 text-xs text-indigo-500 hover:underline">加载示例题目</button>

    </div>

    <script>
        const boardEl = document.getElementById('board');
        const size = 9;
        let inputs = [];

        function init() {
            boardEl.innerHTML = '';
            inputs = [];

            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    const input = document.createElement('input');
                    input.type = 'text'; // using text to allow empty
                    input.inputMode = 'numeric'; // mobile keyboard
                    input.maxLength = 1;
                    input.className = 'cell';

                    if ((c + 1) % 3 === 0 && c !== 8) input.classList.add('br-thick');
                    if ((r + 1) % 3 === 0 && r !== 8) input.classList.add('bb-thick');

                    input.oninput = (e) => {
                        const v = e.target.value;
                        if (!/^[1-9]$/.test(v)) e.target.value = '';
                    };

                    boardEl.appendChild(input);
                    inputs.push(input);
                }
            }
        }

        function getBoard() {
            const board = [];
            for (let r = 0; r < size; r++) {
                const row = [];
                for (let c = 0; c < size; c++) {
                    const val = inputs[r * size + c].value;
                    row.push(val ? parseInt(val) : 0);
                }
                board.push(row);
            }
            return board;
        }

        function setBoard(board, original) {
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    const idx = r * size + c;
                    const val = board[r][c];
                    inputs[idx].value = val;

                    if (original[r][c] === 0) {
                        inputs[idx].classList.add('solved');
                    } else {
                        inputs[idx].classList.remove('solved');
                    }
                }
            }
        }

        function isValid(board, r, c, num) {
            // Row
            for (let i = 0; i < size; i++) if (board[r][i] === num) return false;
            // Col
            for (let i = 0; i < size; i++) if (board[i][c] === num) return false;
            // Box
            const startR = Math.floor(r / 3) * 3;
            const startC = Math.floor(c / 3) * 3;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (board[startR + i][startC + j] === num) return false;
                }
            }
            return true;
        }

        function solveBacktrack(board) {
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (board[r][c] === 0) {
                        for (let num = 1; num <= 9; num++) {
                            if (isValid(board, r, c, num)) {
                                board[r][c] = num;
                                if (solveBacktrack(board)) return true;
                                board[r][c] = 0; // Backtrack
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function solve() {
            const currentBoard = getBoard();
            // Clone for reference of original clues
            const originalBoard = JSON.parse(JSON.stringify(currentBoard));

            // Validate initial state
            // (Skipped for brevity, assume user inputs valid partial board, or solver returns false immediately)

            if (solveBacktrack(currentBoard)) {
                setBoard(currentBoard, originalBoard);
            } else {
                alert("无解！请检查输入是否冲突。");
            }
        }

        function reset() {
            inputs.forEach(i => {
                i.value = '';
                i.classList.remove('solved');
            });
        }

        function loadSample() {
            reset();
            const sample = [
                5, 3, 0, 0, 7, 0, 0, 0, 0,
                6, 0, 0, 1, 9, 5, 0, 0, 0,
                0, 9, 8, 0, 0, 0, 0, 6, 0,
                8, 0, 0, 0, 6, 0, 0, 0, 3,
                4, 0, 0, 8, 0, 3, 0, 0, 1,
                7, 0, 0, 0, 2, 0, 0, 0, 6,
                0, 6, 0, 0, 0, 0, 2, 8, 0,
                0, 0, 0, 4, 1, 9, 0, 0, 5,
                0, 0, 0, 0, 8, 0, 0, 7, 9
            ];
            sample.forEach((val, i) => {
                if (val !== 0) inputs[i].value = val;
            });
        }

        init();
    </script>
</body>

</html>