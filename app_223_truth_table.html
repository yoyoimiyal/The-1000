<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>真值表生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .true-cell {
            background-color: #dcfce7;
            color: #166534;
        }

        .false-cell {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .result-col {
            border-left: 2px solid #cbd5e1;
            font-weight: bold;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen flex flex-col items-center p-6 text-slate-800">

    <div class="w-full max-w-3xl">

        <header class="flex justify-between items-center mb-8">
            <h1 class="text-2xl font-bold text-indigo-700 flex items-center gap-2">
                <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs">T/F</span> Truth Table
            </h1>
            <a href="./navigation.html" class="text-sm text-slate-400 hover:text-indigo-600">退出</a>
        </header>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-6">
            <label class="block text-xs font-bold text-slate-400 uppercase mb-2">逻辑表达式 (Boolean Expression)</label>
            <div class="flex gap-4">
                <input type="text" id="expression"
                    class="flex-1 p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500 font-mono text-lg"
                    placeholder="A && (B || !C)" value="A && (B || !C)" onkeypress="if(event.key==='Enter') generate()">
                <button onclick="generate()"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 rounded-lg font-bold transition shadow">生成</button>
            </div>

            <div class="flex gap-2 mt-3 text-xs text-slate-500">
                <span>支持符号:</span>
                <button onclick="addSym('&&')" class="bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded">&&
                    (AND)</button>
                <button onclick="addSym('||')" class="bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded">||
                    (OR)</button>
                <button onclick="addSym('!')" class="bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded">! (NOT)</button>
                <button onclick="addSym('^')" class="bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded">^ (XOR)</button>
            </div>

            <div id="error-msg" class="text-xs text-red-500 mt-2 h-4"></div>
        </div>

        <!-- Table -->
        <div class="bg-white rounded-2xl shadow-md overflow-hidden border border-slate-200">
            <div class="overflow-x-auto">
                <table class="w-full text-center text-sm">
                    <thead class="bg-slate-100 text-slate-500 font-bold uppercase text-xs" id="table-head">
                        <!-- Headers -->
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-100 font-mono">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        function addSym(sym) {
            const input = document.getElementById('expression');
            input.value += ' ' + sym + ' ';
            input.focus();
        }

        function generate() {
            const exprStr = document.getElementById('expression').value;
            const errEl = document.getElementById('error-msg');
            const thead = document.getElementById('table-head');
            const tbody = document.getElementById('table-body');

            errEl.innerText = "";
            thead.innerHTML = "";
            tbody.innerHTML = "";

            // Extract variables (A-Z)
            const variables = [...new Set(exprStr.match(/[A-Z]+/g))].sort();

            if (variables.length === 0) {
                errEl.innerText = "Error: 未找到变量 (A-Z)";
                return;
            }
            if (variables.length > 10) {
                errEl.innerText = "Error: 变量过多 (Max 10)";
                return;
            }

            // Build Header
            let headHTML = "<tr>";
            variables.forEach(v => headHTML += `<th class="py-3 px-4">${v}</th>`);
            headHTML += `<th class="py-3 px-4 bg-indigo-50 text-indigo-700 result-col">${exprStr}</th></tr>`;
            thead.innerHTML = headHTML;

            // Generate rows (2^n)
            const rows = Math.pow(2, variables.length);

            for (let i = 0; i < rows; i++) {
                const tr = document.createElement('tr');
                const env = {};

                // Set variables for this row
                // Iterate backwards to match binary convention (000, 001, 010...)
                // High bit for first var
                for (let j = 0; j < variables.length; j++) {
                    const val = (i >> (variables.length - 1 - j)) & 1; // 0 or 1
                    env[variables[j]] = val;

                    const td = document.createElement('td');
                    td.className = "py-2 px-4 " + (val ? "text-green-600" : "text-slate-400");
                    td.innerText = val ? "1" : "0"; // or T/F
                    tr.appendChild(td);
                }

                // Eval expression
                let resultVal;
                try {
                    // Replace vars with values
                    // Sort by length desc to avoid replacing 'AB' with '1B' if A=1
                    const sortedVars = [...variables].sort((a, b) => b.length - a.length);
                    let evalStr = exprStr;

                    // Safe replacement using regex word boundary
                    sortedVars.forEach(v => {
                        const regex = new RegExp(`\\b${v}\\b`, 'g');
                        evalStr = evalStr.replace(regex, env[v]);
                    });

                    // JS Logic: ^ is XOR in bitwise, work for 0/1. 
                    // && || ! works.
                    // Just eval
                    const res = eval(evalStr);
                    resultVal = res ? 1 : 0;

                } catch (e) {
                    resultVal = "ERR";
                    errEl.innerText = "表达式语法错误";
                }

                const resultTd = document.createElement('td');
                resultTd.className = `py-2 px-4 result-col ${resultVal === 1 ? 'true-cell' : (resultVal === 0 ? 'false-cell' : '')}`;
                resultTd.innerText = resultVal === 1 ? "True" : (resultVal === 0 ? "False" : "ERR");
                tr.appendChild(resultTd);

                tbody.appendChild(tr);
            }
        }

        // Init
        generate();
    </script>
</body>

</html>