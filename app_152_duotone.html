<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒè‰²è°ƒå›¾ç‰‡ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 min-h-screen flex flex-col items-center p-6 text-white">

    <div class="w-full max-w-4xl">

        <header class="flex justify-between items-center mb-8">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                <span class="bg-gradient-to-r from-pink-500 to-purple-500 text-transparent bg-clip-text">Duotone</span>
                Effect
            </h1>
            <a href="./navigation.html" class="text-sm text-gray-400 hover:text-white">é€€å‡º</a>
        </header>

        <div class="flex flex-col md:flex-row gap-8">

            <!-- Controls -->
            <div class="w-full md:w-80 space-y-6">

                <div class="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                    <label
                        class="block w-full py-3 border-2 border-dashed border-gray-600 rounded-xl text-center cursor-pointer hover:bg-gray-700 transition mb-6">
                        <span class="text-gray-400 font-bold text-sm">ğŸ“‚ ä¸Šä¼ å›¾ç‰‡</span>
                        <input type="file" class="hidden" accept="image/*" onchange="loadImage(event)">
                    </label>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">é«˜å…‰é¢œè‰² (Highlight)</label>
                            <div class="flex gap-2">
                                <input type="color" id="col-light" value="#00ff00"
                                    class="w-10 h-10 rounded border-0 p-0 cursor-pointer" oninput="render()">
                                <input type="text"
                                    class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 text-xs text-white"
                                    value="#00ff00" readonly>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">é˜´å½±é¢œè‰² (Shadow)</label>
                            <div class="flex gap-2">
                                <input type="color" id="col-dark" value="#0000ff"
                                    class="w-10 h-10 rounded border-0 p-0 cursor-pointer" oninput="render()">
                                <input type="text"
                                    class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 text-xs text-white"
                                    value="#0000ff" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 pt-6 border-t border-gray-700">
                        <p class="text-xs font-bold text-gray-400 uppercase mb-2">é¢„è®¾</p>
                        <div class="flex gap-2">
                            <button onclick="setPreset('#fbbf24', '#b91c1c')"
                                class="w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 to-red-700 border border-white/20"></button>
                            <button onclick="setPreset('#22d3ee', '#1e3a8a')"
                                class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-900 border border-white/20"></button>
                            <button onclick="setPreset('#f472b6', '#4c1d95')"
                                class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-violet-900 border border-white/20"></button>
                            <button onclick="setPreset('#4ade80', '#064e3b')"
                                class="w-8 h-8 rounded-full bg-gradient-to-br from-green-400 to-emerald-900 border border-white/20"></button>
                        </div>
                    </div>
                </div>

                <button onclick="download()"
                    class="w-full py-3 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition shadow-lg">ä¸‹è½½å›¾ç‰‡</button>

            </div>

            <!-- Preview -->
            <div
                class="flex-1 bg-black rounded-2xl overflow-hidden flex items-center justify-center relative min-h-[400px] border border-gray-800">
                <canvas id="canvas" class="max-w-full max-h-[70vh]"></canvas>
                <div id="placeholder" class="absolute text-gray-600 font-bold">Preview Area</div>
            </div>

        </div>

    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const colLight = document.getElementById('col-light');
        const colDark = document.getElementById('col-dark');
        const placeholder = document.getElementById('placeholder');

        let originalImg = null;

        // Default Load (Sample)
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = "https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80";
        img.onload = () => {
            originalImg = img;
            render();
            placeholder.style.display = 'none';
        };

        function loadImage(event) {
            const file = event.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                const newImg = new Image();
                newImg.onload = () => {
                    originalImg = newImg;
                    render();
                    placeholder.style.display = 'none';
                };
                newImg.src = url;
            }
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return { r, g, b };
        }

        function render() {
            if (!originalImg) return;

            canvas.width = originalImg.width;
            canvas.height = originalImg.height;

            ctx.drawImage(originalImg, 0, 0);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            const light = hexToRgb(colLight.value);
            const dark = hexToRgb(colDark.value);

            for (let i = 0; i < data.length; i += 4) {
                // Grayscale luminance
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                const norm = avg / 255; // 0 to 1

                // Mix colors based on luminance
                // Dark maps to shadow color (norm=0 -> dark)
                // Light maps to highlight color (norm=1 -> light)

                data[i] = dark.r + (light.r - dark.r) * norm;
                data[i + 1] = dark.g + (light.g - dark.g) * norm;
                data[i + 2] = dark.b + (light.b - dark.b) * norm;
                // Alpha (data[i+3]) remains same
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function setPreset(l, d) {
            colLight.value = l;
            colDark.value = d;
            render();
        }

        function download() {
            const link = document.createElement('a');
            link.download = 'duotone.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>

</html>