<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTMF 拨号音生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .keypad-btn {
            aspect-ratio: 1;
            border-radius: 12px;
            background: #e2e8f0;
            color: #334155;
            font-size: 2rem;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0 #94a3b8;
            transition: all 0.05s;
            user-select: none;
            cursor: pointer;
        }

        .keypad-btn:active,
        .keypad-btn.active {
            transform: translateY(4px);
            box-shadow: none;
            background: #3b82f6;
            color: white;
        }

        .sub-text {
            font-size: 0.75rem;
            opacity: 0.6;
            font-weight: normal;
            letter-spacing: 2px;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-6 text-slate-800">

    <div class="w-full max-w-sm bg-white p-8 rounded-3xl shadow-2xl border border-gray-200">

        <div
            class="mb-6 bg-green-50 border border-green-200 p-4 rounded-xl text-right min-h-[4rem] flex items-center justify-end overflow-hidden">
            <span id="display" class="text-3xl font-mono text-green-800 tracking-widest"></span>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <button class="keypad-btn" onmousedown="press('1')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('1')" ontouchend="release()">1<span class="sub-text">&nbsp;</span></button>
            <button class="keypad-btn" onmousedown="press('2')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('2')" ontouchend="release()">2<span class="sub-text">ABC</span></button>
            <button class="keypad-btn" onmousedown="press('3')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('3')" ontouchend="release()">3<span class="sub-text">DEF</span></button>

            <button class="keypad-btn" onmousedown="press('4')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('4')" ontouchend="release()">4<span class="sub-text">GHI</span></button>
            <button class="keypad-btn" onmousedown="press('5')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('5')" ontouchend="release()">5<span class="sub-text">JKL</span></button>
            <button class="keypad-btn" onmousedown="press('6')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('6')" ontouchend="release()">6<span class="sub-text">MNO</span></button>

            <button class="keypad-btn" onmousedown="press('7')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('7')" ontouchend="release()">7<span class="sub-text">PQRS</span></button>
            <button class="keypad-btn" onmousedown="press('8')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('8')" ontouchend="release()">8<span class="sub-text">TUV</span></button>
            <button class="keypad-btn" onmousedown="press('9')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('9')" ontouchend="release()">9<span class="sub-text">WXYZ</span></button>

            <button class="keypad-btn" onmousedown="press('*')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('*')" ontouchend="release()">*</button>
            <button class="keypad-btn" onmousedown="press('0')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('0')" ontouchend="release()">0<span class="sub-text">+</span></button>
            <button class="keypad-btn" onmousedown="press('#')" onmouseup="release()" onmouseleave="release()"
                ontouchstart="press('#')" ontouchend="release()">#</button>
        </div>

        <div class="flex justify-between items-center text-xs text-gray-400">
            <button onclick="document.getElementById('display').innerText = ''" class="hover:text-red-500">清除显示</button>
            <a href="./navigation.html" class="hover:text-blue-600">退出</a>
        </div>

    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let osc1, osc2, gainNode;

        const dtmfFrequencies = {
            '1': [697, 1209], '2': [697, 1336], '3': [697, 1477],
            '4': [770, 1209], '5': [770, 1336], '6': [770, 1477],
            '7': [852, 1209], '8': [852, 1336], '9': [852, 1477],
            '*': [941, 1209], '0': [941, 1336], '#': [941, 1477]
        };

        const display = document.getElementById('display');

        function startTone(freqs) {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            if (osc1) osc1.stop();
            if (osc2) osc2.stop();

            osc1 = audioCtx.createOscillator();
            osc2 = audioCtx.createOscillator();
            gainNode = audioCtx.createGain();

            osc1.frequency.value = freqs[0];
            osc2.frequency.value = freqs[1];

            osc1.type = 'sine';
            osc2.type = 'sine';

            osc1.connect(gainNode);
            osc2.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            gainNode.gain.value = 0.2;

            osc1.start();
            osc2.start();
        }

        function stopTone() {
            if (gainNode) {
                const now = audioCtx.currentTime;
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                if (osc1) osc1.stop(now + 0.05);
                if (osc2) osc2.stop(now + 0.05);
            }
        }

        function press(key) {
            startTone(dtmfFrequencies[key]);

            // Limit display length
            if (display.innerText.length > 12) {
                display.innerText = display.innerText.substring(1);
            }
            display.innerText += key;
        }

        function release() {
            stopTone();
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (dtmfFrequencies[e.key] && !e.repeat) {
                // Find button to visualize active state? 
                // Simplified for now, just play
                press(e.key);
            }
        });
        document.addEventListener('keyup', (e) => {
            if (dtmfFrequencies[e.key]) {
                release();
            }
        });
    </script>
</body>

</html>