<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœˆç›¸æ—¥åŽ†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .moon-box {
            width: 200px;
            height: 200px;
            background-color: #1a202c;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.1);
        }

        .moon-shadow {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            border-radius: 50%;
            background-color: #cbd5e1;
            /* Moon color */
        }

        /* CSS Moon Phase Logic is complex with just div/shadows for all phases. 
           We use a simpler SVGs approach or character approach for icon, 
           and a visual simulation using hemishperes. 
           
           Method:
           Base is Dark.
           Phase 0-0.5 (New to Full): Right side lights up, then Left side.
           Actually simpler: Use an SVG path generator for accurate shadow.
        */
    </style>
</head>

<body class="bg-slate-950 min-h-screen flex flex-col items-center justify-center p-6 text-slate-300">

    <div class="w-full max-w-md bg-slate-900 p-8 rounded-3xl shadow-2xl border border-slate-800 text-center">

        <header class="flex justify-between items-center mb-8">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <span class="text-2xl">ðŸŒ‘</span> Moon Phase
            </h1>
            <a href="./navigation.html" class="text-sm text-slate-500 hover:text-white">é€€å‡º</a>
        </header>

        <!-- Moon Visualization -->
        <div class="flex justify-center mb-8">
            <div id="moon-render" class="moon-box flex items-center justify-center border-4 border-slate-800">
                <!-- SVG rendered here -->
            </div>
        </div>

        <div class="mb-8">
            <h2 class="text-3xl font-bold text-white mb-1" id="phase-name">New Moon</h2>
            <p class="text-sm text-slate-500">Age: <span id="moon-age">0</span> days</p>
            <p class="text-sm text-slate-500">Illumination: <span id="moon-illum">0%</span></p>
        </div>

        <div class="flex items-center gap-4 bg-slate-800 p-2 rounded-xl">
            <button onclick="changeDay(-1)" class="p-2 hover:text-white text-slate-500 transition">â—€</button>
            <input type="date" id="date-picker"
                class="bg-transparent border-none text-center text-white font-mono outline-none" onchange="update()">
            <button onclick="changeDay(1)" class="p-2 hover:text-white text-slate-500 transition">â–¶</button>
        </div>

        <button onclick="resetToday()"
            class="mt-4 text-xs text-indigo-400 hover:text-indigo-300 font-bold uppercase">Back to Today</button>

    </div>

    <script>
        const phaseNameEl = document.getElementById('phase-name');
        const moonAgeEl = document.getElementById('moon-age');
        const moonIllumEl = document.getElementById('moon-illum');
        const moonRender = document.getElementById('moon-render');
        const datePicker = document.getElementById('date-picker');

        let currentDate = new Date();

        function init() {
            resetToday();
        }

        function resetToday() {
            currentDate = new Date();
            updateDatePicker();
            update();
        }

        function changeDay(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            updateDatePicker();
            update();
        }

        function updateDatePicker() {
            datePicker.value = currentDate.toISOString().split('T')[0];
        }

        function getMoonData(date) {
            // Simple calculation based on known new moon (Synodic month 29.53059 days)
            // Reference New Moon: Jan 6, 2000
            const knownNewMoon = new Date('2000-01-06T18:14:00Z');
            const diffTime = date.getTime() - knownNewMoon.getTime();
            const diffDays = diffTime / (1000 * 60 * 60 * 24);
            const cycle = 29.53059;
            const age = diffDays % cycle; // Days since new moon

            // Normalize positive
            const moonAge = age < 0 ? age + cycle : age;

            // Phase (0 to 1)
            const phase = moonAge / cycle;

            return { age: moonAge, phase: phase };
        }

        function renderMoonSVG(phase) {
            // phase 0..1
            // 0 = New, 0.5 = Full, 1 = New

            // We simulate shadow by drawing two arcs.
            // Simplified approach: Draw a circle (moon body), then overlay a shadow shape.

            // Using a path to draw the lit part.
            // Center (100, 100), Radius 90.

            // Calculation for terminator curve (ellipse arc)
            // x varies from -90 to 90.
            // Full Moon (0.5): Circle.
            // New Moon (0/1): Black.

            // Let's use a simpler visual approximation with <path>
            // Based on phase:
            // 0-0.5: Waxing (Light grows from Right)
            // 0.5-1: Waning (Light shrinks to Left)

            // North hemisphere perspective:
            // 0: Dark
            // 0.25: Right half lit (First Quarter)
            // 0.5: Full
            // 0.75: Left half lit (Last Quarter)

            let d = "";
            const r = 90;
            const cx = 100;
            const cy = 100;

            // Illumination %
            const illum = 0.5 * (1 - Math.cos(phase * 2 * Math.PI));

            // Generate visual
            // We draw the light part on top of dark background

            // Hemisphere logic for SVG path is tricky.
            // Let's use a mask trick or just CSS border-radius hacks?
            // Actually, SVG is best.

            // Let p = phase
            // If p < 0.5: Waxing. 
            //   Right limb is arc. Left terminator moves left to right.
            // If p > 0.5: Waning.
            //   Left limb is arc. Right terminator moves left to right? No.

            // Better visual:
            // Draw full moon (White). Mask it with shadow (Black).

            // Shadow offset X: -r to r
            // We approximate terminator as an elliptical arc.
            // sweep: 1 for right arc, 0 for left?

            // Let's use simplified text + simple circle fill for MVP stability if math is too complex for single file.
            // But we want cool visual. Let's try CSS shadow hack?

            // CSS Hack:
            // 2 semicircles + 1 oval overlay.
            // It's robust.

            let shadowStyle = "";
            let lightStyle = "";

            // Normalize for visual calculation (0 = New, 0.5 = Full, 1 = New)
            // Let's create the SVG path for the LIT portion.

            // Arc always from Top (100, 10) to Bottom (100, 190)
            // Outer arc depends on phase < 0.5 (Right) or > 0.5 (Left)
            // Inner arc (terminator) depends on illumination.

            const sweepOuter = phase < 0.5 ? 1 : 0; // Right side or Left side base
            // But full moon needs both?

            // Let's rely on a simpler visual:
            // Moon is gray.
            // Shadow is black with opacity.

            // Actually, let's use the provided logic:
            // Phase 0..1

            let p = phase;
            let sweep = 0;
            let mag = 0;

            // Calculate terminator x-radius
            // Varies from r to -r
            let rx = r * Math.cos(p * 2 * Math.PI);

            // Logic:
            // Path: Move to Top. Arc to Bottom (Outer). Arc to Top (Terminator).
            // Outer Arc: Always half circle?
            // If Waxing (0-0.5): Outer is Right Semicircle (1). Terminator goes from Right to Left.
            // If Waning (0.5-1): Outer is Left Semicircle (0). Terminator goes from Left to Right.

            let outerSweep = p < 0.5 ? 1 : 0;
            let innerSweep = p < 0.5 ? 0 : 1;

            // Terminator x radius: 
            // At 0: rx = r. Path is Right Arc, then Left Arc (circle). Wait, 0 is new moon (dark).
            // At 0.25: rx = 0. Straight line. Right semicircle lit.
            // At 0.5: rx = -r. Full moon.

            // Path D:
            // M 100,10 
            // A 90 90 0 0 {outerSweep} 100 190  (Outer rim)
            // A {abs(rx)} 90 0 0 {innerSweep} 100 10 (Terminator)

            // Correction for 0.5 and 0 (full/new) where arcs overlap or fill

            // Visual Fix:
            // If Waxing (0-0.5):
            //   Light is on the Right.
            //   Background Black.
            //   Draw White shape.
            //   Outer edge: Right Semicircle.
            //   Inner edge: Ellipse from Top to Bottom.
            //     0-0.25: Ellipse curves Left (concave).
            //     0.25-0.5: Ellipse curves Right (convex).

            const isWaxing = p <= 0.5;
            const xRadius = Math.abs(r * Math.cos(p * 2 * Math.PI));

            // Direction of terminator arc
            // 0-0.25: Sweep 1 (match outer) -> Crescent
            // 0.25-0.5: Sweep 0 (opposite) -> Gibbous
            // 0.5-0.75: Sweep 1 (match outer left) -> Gibbous
            // 0.75-1.0: Sweep 0 (opposite) -> Crescent

            let termSweep;
            if (p < 0.25) termSweep = 0;
            else if (p < 0.5) termSweep = 1;
            else if (p < 0.75) termSweep = 0;
            else termSweep = 1;

            d = `M 100,10 A 90 90 0 0 ${outerSweep} 100 190 A ${xRadius} 90 0 0 ${termSweep} 100 10`;

            // Full Moon Patch (when near 0.5, svg arc gets thin, maybe fill circle)
            // New Moon Patch (when near 0/1, hide)

            let fill = "#cbd5e1"; // Moon color
            if (p > 0.48 && p < 0.52) {
                // Full
                d = `M 100,10 A 90 90 0 1 1 100 190 A 90 90 0 1 1 100 10`;
            }
            if (p < 0.02 || p > 0.98) {
                // New
                fill = "transparent";
            }

            return `<svg viewBox="0 0 200 200" width="100%" height="100%">
                <circle cx="100" cy="100" r="90" fill="#111" stroke="none" />
                <path d="${d}" fill="${fill}" stroke="none" />
            </svg>`;
        }

        function update() {
            const data = getMoonData(new Date(datePicker.value));

            moonRender.innerHTML = renderMoonSVG(data.phase);

            moonAgeEl.innerText = data.age.toFixed(1);

            const illum = (0.5 * (1 - Math.cos(data.phase * 2 * Math.PI))) * 100;
            moonIllumEl.innerText = illum.toFixed(0) + "%";

            // Phase Name
            let name = "";
            const age = data.age;
            if (age < 1 || age > 28.5) name = "New Moon (æ–°æœˆ)";
            else if (age < 7) name = "Waxing Crescent (è›¾çœ‰æœˆ)";
            else if (age < 8) name = "First Quarter (ä¸Šå¼¦æœˆ)";
            else if (age < 14) name = "Waxing Gibbous (ç›ˆå‡¸æœˆ)";
            else if (age < 15.5) name = "Full Moon (æ»¡æœˆ)";
            else if (age < 22) name = "Waning Gibbous (äºå‡¸æœˆ)";
            else if (age < 23) name = "Last Quarter (ä¸‹å¼¦æœˆ)";
            else name = "Waning Crescent (æ®‹æœˆ)";

            phaseNameEl.innerText = name;
        }

        init();
    </script>
</body>

</html>