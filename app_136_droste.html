<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·ç½—æ–¯ç‰¹æ•ˆåº”ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .droste-container {
            position: relative;
            overflow: hidden;
            width: 300px;
            height: 300px;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body class="bg-slate-900 min-h-screen flex flex-col items-center justify-center p-6">

    <div class="w-full max-w-4xl flex flex-col md:flex-row gap-8 items-center">

        <!-- Preview -->
        <div class="flex-1 flex justify-center">
            <div id="droste-box" class="droste-container rounded-xl">
                <!-- Layers injected here -->
                <p class="text-slate-400 font-bold">è¯·å…ˆä¸Šä¼ å›¾ç‰‡</p>
            </div>
        </div>

        <!-- Controls -->
        <div class="w-full md:w-80 bg-white p-6 rounded-2xl shadow-xl">
            <header class="flex justify-between items-center mb-6">
                <h1 class="text-xl font-bold text-slate-800">Droste Effect</h1>
                <a href="./navigation.html" class="text-xs text-slate-400 hover:text-indigo-600">é€€å‡º</a>
            </header>

            <div class="space-y-6">
                <label
                    class="block w-full py-3 px-4 border-2 border-dashed border-slate-300 rounded-xl text-center cursor-pointer hover:bg-slate-50 transition">
                    <span class="text-slate-500 font-bold text-sm">ğŸ“‚ ä¸Šä¼ å›¾ç‰‡</span>
                    <input type="file" class="hidden" accept="image/*" onchange="loadImage(event)">
                </label>

                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-2">å±‚æ•° (Layers)</label>
                    <input type="range" id="layers" min="2" max="10" value="5"
                        class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="render()">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-2">ç¼©æ”¾æ¯”ä¾‹ (Scale)</label>
                    <input type="range" id="scale" min="20" max="80" value="60"
                        class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="render()">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-2">æ—‹è½¬ (Rotate)</label>
                    <input type="range" id="rotate" min="0" max="360" value="0"
                        class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="render()">
                </div>
            </div>
        </div>

    </div>

    <script>
        const container = document.getElementById('droste-box');
        let imgUrl = null;

        function loadImage(event) {
            const file = event.target.files[0];
            if (file) {
                imgUrl = URL.createObjectURL(file);
                render();
            }
        }

        function render() {
            if (!imgUrl) return;

            const layersCount = parseInt(document.getElementById('layers').value);
            const scalePct = parseInt(document.getElementById('scale').value) / 100;
            const rotateDeg = parseInt(document.getElementById('rotate').value);

            container.innerHTML = '';

            // Base Size
            const size = 300;

            // Create layers from smallest (inner) to largest (outer) ?? 
            // Actually recursion goes inward. Outer layer contains inner layer.
            // HTML stacking: Last element is on top.
            // So we render Largest first? No, Smallest on top covering center.

            // We need to simulate:
            // Layer 0: Full size (Bottom)
            // Layer 1: Scaled down, on top of Layer 0
            // Layer 2: Scaled down again, on top of Layer 1

            for (let i = 0; i < layersCount; i++) {
                const layer = document.createElement('div');
                layer.className = 'layer';

                // Calculate size: size * (scale ^ i)
                const currentSize = size * Math.pow(scalePct, i);

                layer.style.width = `${currentSize}px`;
                layer.style.height = `${currentSize}px`;
                layer.style.backgroundImage = `url(${imgUrl})`;

                // Rotation adds up
                layer.style.transform = `translate(-50%, -50%) rotate(${rotateDeg * i}deg)`;
                // Radius to match image?
                // layer.style.borderRadius = '10px'; // Optional

                container.appendChild(layer);
            }
        }
    </script>
</body>

</html>