<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电子气泡纸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bubble {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle at 15px 15px, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.1) 40%, rgba(255, 255, 255, 0) 60%), #60a5fa;
            /* blue-400 */
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2), inset -2px -2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.1s;
            position: relative;
        }

        .bubble:active {
            transform: scale(0.95);
        }

        .bubble.popped {
            background: #cbd5e1;
            /* slate-300 */
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
        }

        .bubble::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            width: 10px;
            height: 5px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: rotate(-45deg);
        }

        .bubble.popped::after {
            display: none;
        }
    </style>
</head>

<body class="bg-blue-50 min-h-screen flex flex-col items-center justify-center p-4">

    <header class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-blue-900 mb-2">Bubble Wrap</h1>
        <p class="text-blue-400 text-sm">点击气泡解压 · <span id="score">0</span> Popped</p>
    </header>

    <div class="bg-white p-4 rounded-xl shadow-xl border border-blue-100">
        <div class="grid grid-cols-5 sm:grid-cols-6 gap-3" id="grid">
            <!-- Bubbles -->
        </div>
    </div>

    <div class="mt-8 flex gap-4">
        <button onclick="reset()"
            class="bg-white text-blue-600 px-6 py-2 rounded-full shadow hover:bg-blue-50 font-bold transition">
            重置 (Reset)
        </button>
        <a href="./navigation.html" class="text-blue-300 hover:text-blue-500 py-2 text-sm">退出</a>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const scoreEl = document.getElementById('score');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let poppedCount = 0;

        function init() {
            grid.innerHTML = '';
            poppedCount = 0;
            scoreEl.innerText = 0;
            // Create 30 bubbles
            for (let i = 0; i < 30; i++) {
                const b = document.createElement('div');
                b.className = 'bubble';
                b.onclick = () => pop(b);
                grid.appendChild(b);
            }
        }

        function playPopSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            // Quick frequency sweep down for "pop" sound
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);

            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function pop(el) {
            if (el.classList.contains('popped')) return;

            el.classList.add('popped');
            playPopSound();
            poppedCount++;
            scoreEl.innerText = poppedCount;

            // Auto refill if all popped?
            if (poppedCount === 30) {
                setTimeout(() => {
                    if (confirm("全部捏完了！再来一张？")) reset();
                }, 500);
            }
        }

        function reset() {
            const bubbles = document.querySelectorAll('.bubble');
            bubbles.forEach(b => {
                b.classList.remove('popped');
            });
            poppedCount = 0;
            scoreEl.innerText = 0;
        }

        init();
    </script>
</body>

</html>