<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>白噪音发生器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .noise-bg {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1'/%3E%3C/svg%3E");
        }

        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
    </style>
</head>

<body
    class="bg-slate-900 text-white min-h-screen flex items-center justify-center p-4 noise-bg transition-colors duration-1000"
    id="body">

    <div
        class="w-full max-w-md bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-8 shadow-2xl relative overflow-hidden">

        <div class="flex justify-between items-start mb-8">
            <div>
                <h1 class="text-3xl font-light tracking-wide mb-1">Noise Gen</h1>
                <p class="text-sm text-white/50">专注 · 睡眠 · 放松</p>
            </div>
            <a href="./navigation.html" class="text-white/30 hover:text-white transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </a>
        </div>

        <!-- Visualizer Placeholder -->
        <div class="h-24 flex items-center justify-center gap-1 mb-10" id="visualizer">
            <div class="w-2 h-8 bg-white/80 rounded-full animate-pulse" style="animation-delay: 0s"></div>
            <div class="w-2 h-12 bg-white/80 rounded-full animate-pulse" style="animation-delay: 0.1s"></div>
            <div class="w-2 h-6 bg-white/80 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
            <div class="w-2 h-10 bg-white/80 rounded-full animate-pulse" style="animation-delay: 0.3s"></div>
            <div class="w-2 h-5 bg-white/80 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
        </div>

        <!-- Controls -->
        <div class="space-y-8">

            <!-- Type Selector -->
            <div class="grid grid-cols-3 gap-3 p-1 bg-black/20 rounded-xl">
                <button onclick="setNoise('white')" id="btn-white"
                    class="py-2 rounded-lg text-sm font-medium bg-white text-slate-900 shadow transition-all">白噪音</button>
                <button onclick="setNoise('pink')" id="btn-pink"
                    class="py-2 rounded-lg text-sm font-medium text-white/70 hover:bg-white/10 transition-all">粉红噪音</button>
                <button onclick="setNoise('brown')" id="btn-brown"
                    class="py-2 rounded-lg text-sm font-medium text-white/70 hover:bg-white/10 transition-all">红/褐噪音</button>
            </div>

            <!-- Volume -->
            <div>
                <div class="flex justify-between text-xs uppercase tracking-widest text-white/50 mb-4">
                    <span>Volume</span>
                    <span id="vol-val">50%</span>
                </div>
                <input type="range" min="0" max="1" step="0.01" value="0.5" class="w-full"
                    oninput="setVolume(this.value)">
            </div>

            <!-- Play Toggle -->
            <button onclick="togglePlay()" id="play-btn"
                class="w-full py-4 bg-white text-slate-900 rounded-xl font-bold text-lg hover:bg-indigo-50 transition shadow-lg flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                开始播放
            </button>

        </div>
    </div>

    <script>
        let audioCtx;
        let noiseSource;
        let gainNode;
        let isPlaying = false;
        let currentType = 'white';
        let currentVolume = 0.5;

        const body = document.getElementById('body');
        const playBtn = document.getElementById('play-btn');
        const visualizer = document.getElementById('visualizer');

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function createNoiseBuffer() {
            if (!audioCtx) return;
            const bufferSize = audioCtx.sampleRate * 2; // 2 seconds buffer
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);

            if (currentType === 'white') {
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
            } else if (currentType === 'pink') {
                let b0, b1, b2, b3, b4, b5, b6;
                b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    b0 = 0.99886 * b0 + white * 0.0555179;
                    b1 = 0.99332 * b1 + white * 0.0750759;
                    b2 = 0.96900 * b2 + white * 0.1538520;
                    b3 = 0.86650 * b3 + white * 0.3104856;
                    b4 = 0.55000 * b4 + white * 0.5329522;
                    b5 = -0.7616 * b5 - white * 0.0168980;
                    data[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                    data[i] *= 0.11; // (roughly) compensate for gain
                    b6 = white * 0.115926;
                }
            } else if (currentType === 'brown') {
                let lastOut = 0.0;
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    lastOut = (lastOut + (0.02 * white)) / 1.02;
                    data[i] = lastOut * 3.5;
                }
            }

            return buffer;
        }

        function setNoise(type) {
            currentType = type;

            // Update UI
            ['white', 'pink', 'brown'].forEach(t => {
                const btn = document.getElementById(`btn-${t}`);
                if (t === type) {
                    btn.className = "py-2 rounded-lg text-sm font-medium bg-white text-slate-900 shadow transition-all";
                } else {
                    btn.className = "py-2 rounded-lg text-sm font-medium text-white/70 hover:bg-white/10 transition-all";
                }
            });

            // Update Background Theme
            if (type === 'white') body.className = "bg-slate-900 text-white min-h-screen flex items-center justify-center p-4 noise-bg transition-colors duration-1000";
            if (type === 'pink') body.className = "bg-rose-900 text-white min-h-screen flex items-center justify-center p-4 noise-bg transition-colors duration-1000";
            if (type === 'brown') body.className = "bg-amber-900 text-white min-h-screen flex items-center justify-center p-4 noise-bg transition-colors duration-1000";

            if (isPlaying) {
                stopNoise();
                playNoise();
            }
        }

        function playNoise() {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            noiseSource = audioCtx.createBufferSource();
            noiseSource.buffer = createNoiseBuffer();
            noiseSource.loop = true;

            gainNode = audioCtx.createGain();
            gainNode.gain.value = currentVolume;

            noiseSource.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            noiseSource.start(0);
        }

        function stopNoise() {
            if (noiseSource) {
                noiseSource.stop();
                noiseSource.disconnect();
            }
        }

        function togglePlay() {
            if (isPlaying) {
                stopNoise();
                isPlaying = false;
                playBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> 开始播放`;
                visualizer.style.opacity = '0.3';
            } else {
                playNoise();
                isPlaying = true;
                playBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> 停止播放`;
                visualizer.style.opacity = '1';
            }
        }

        function setVolume(val) {
            currentVolume = val;
            document.getElementById('vol-val').innerText = Math.round(val * 100) + "%";
            if (gainNode) {
                gainNode.gain.value = val;
            }
        }
    </script>
</body>

</html>