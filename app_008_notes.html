<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>本地便签</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Reenie+Beanie&family=Roboto:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        .handwritten {
            font-family: 'Reenie Beanie', cursive;
            font-size: 1.5rem;
            line-height: 1.2;
        }

        .note-card {
            transform: rotate(var(--rotation));
            transition: transform 0.2s;
        }

        .note-card:hover {
            transform: scale(1.05) rotate(0deg) !important;
            z-index: 10;
        }
    </style>
</head>

<body class="bg-amber-50 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white p-4 shadow-sm flex justify-between items-center z-20">
        <h1 class="text-xl font-bold text-slate-700 flex items-center gap-2">
            <span class="bg-yellow-300 px-2 py-1 rounded shadow-sm text-sm transform -rotate-2">Sticky</span> Notes
        </h1>
        <div class="flex gap-4">
            <button onclick="addNote()"
                class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold px-4 py-2 rounded-lg shadow transition flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                        clip-rule="evenodd" />
                </svg>
                添加便签
            </button>
            <a href="./navigation.html" class="text-slate-400 hover:text-slate-600 flex items-center px-2">退出</a>
        </div>
    </header>

    <!-- Notes Container -->
    <div id="notes-container"
        class="flex-1 p-8 overflow-y-auto flex flex-wrap content-start gap-6 justify-center sm:justify-start">
        <!-- Notes injected here -->
    </div>

    <!-- Empty State -->
    <div id="empty-state"
        class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center text-slate-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto mb-4" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="text-xl">还没有便签，点击右上角添加一个吧！</p>
    </div>

    <script>
        let notes = JSON.parse(localStorage.getItem('my_sticky_notes') || '[]');
        const container = document.getElementById('notes-container');
        const emptyState = document.getElementById('empty-state');

        const colors = ['bg-yellow-200', 'bg-blue-200', 'bg-green-200', 'bg-pink-200', 'bg-purple-200'];

        function saveNotes() {
            localStorage.setItem('my_sticky_notes', JSON.stringify(notes));
            renderNotes();
        }

        function addNote() {
            const newNote = {
                id: Date.now(),
                text: '',
                color: colors[Math.floor(Math.random() * colors.length)],
                rotation: (Math.random() * 6 - 3).toFixed(1) + 'deg'
            };
            notes.push(newNote);
            saveNotes();
        }

        function updateNoteText(id, text) {
            const note = notes.find(n => n.id === id);
            if (note) {
                note.text = text;
                localStorage.setItem('my_sticky_notes', JSON.stringify(notes)); // Save without re-render to keep focus
            }
        }

        function deleteNote(id) {
            if (confirm('确定要删除这张便签吗？')) {
                notes = notes.filter(n => n.id !== id);
                saveNotes();
            }
        }

        function renderNotes() {
            container.innerHTML = '';

            if (notes.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                notes.forEach(note => {
                    const el = document.createElement('div');
                    el.className = `note-card ${note.color} w-64 h-64 p-4 shadow-lg flex flex-col relative`;
                    el.style.setProperty('--rotation', note.rotation);

                    el.innerHTML = `
                        <textarea 
                            class="flex-1 w-full bg-transparent resize-none border-none outline-none handwritten text-slate-800 placeholder-slate-500/50" 
                            placeholder="写点什么..."
                            oninput="updateNoteText(${note.id}, this.value)"
                        >${note.text}</textarea>
                        <button onclick="deleteNote(${note.id})" class="absolute top-2 right-2 text-slate-500 hover:text-red-500 opacity-0 hover:opacity-100 transition-opacity p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                    `;

                    // Show delete btn on hover
                    el.addEventListener('mouseenter', () => el.querySelector('button').style.opacity = '1');
                    el.addEventListener('mouseleave', () => el.querySelector('button').style.opacity = '0');

                    container.appendChild(el);
                });
            }
        }

        renderNotes();
    </script>
</body>

</html>