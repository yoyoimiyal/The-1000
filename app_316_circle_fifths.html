<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>五度圈查询器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slice {
            transition: fill 0.2s, transform 0.2s;
            cursor: pointer;
        }

        .slice:hover {
            fill: #e0e7ff;
        }

        .slice.active {
            fill: #4f46e5;
        }

        .text-active {
            fill: #ffffff;
            font-weight: bold;
        }

        .key-text {
            font-family: 'Times New Roman', serif;
            pointer-events: none;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen flex flex-col items-center justify-center p-6 text-slate-800">

    <div
        class="w-full max-w-4xl bg-white p-8 rounded-3xl shadow-xl border border-slate-200 flex flex-col md:flex-row gap-8 items-center">

        <!-- The Circle -->
        <div class="relative w-[320px] h-[320px] shrink-0">
            <svg viewBox="0 0 400 400" id="circle-svg" class="w-full h-full drop-shadow-lg">
                <!-- Generated by JS -->
            </svg>
            <!-- Center Label -->
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <div class="text-center">
                    <h2 class="text-4xl font-black text-slate-700" id="center-key">C</h2>
                    <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">Major</p>
                </div>
            </div>
        </div>

        <!-- Info Panel -->
        <div class="flex-1 w-full space-y-6">

            <header class="flex justify-between items-center border-b border-slate-100 pb-4">
                <h1 class="text-2xl font-bold text-indigo-800">Circle of Fifths</h1>
                <a href="./navigation.html" class="text-sm text-slate-400 hover:text-indigo-600">退出</a>
            </header>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                    <p class="text-xs text-slate-400 font-bold uppercase mb-1">Relative Minor</p>
                    <p class="text-2xl font-bold text-slate-700" id="info-minor">a</p>
                </div>
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                    <p class="text-xs text-slate-400 font-bold uppercase mb-1">Key Signature</p>
                    <p class="text-2xl font-bold text-slate-700" id="info-sig">0</p>
                </div>
            </div>

            <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                <p class="text-xs text-indigo-400 font-bold uppercase mb-2">Chords in Key</p>
                <div class="flex flex-wrap gap-2 text-sm font-bold text-indigo-900" id="info-chords">
                    C, Dm, Em, F, G, Am, Bdim
                </div>
            </div>

            <p class="text-xs text-slate-400 leading-relaxed">
                点击圆环上的任意调性，查看其关系大小调、升降号数量以及调内和弦。
            </p>

        </div>

    </div>

    <script>
        const svg = document.getElementById('circle-svg');

        // Data: Index 0 is C (Top)
        // Clockwise: Sharp keys (#). Counter-Clockwise: Flat keys (b)
        const keys = [
            { maj: 'C', min: 'a', sig: '0', sharps: 0, flats: 0 },
            { maj: 'G', min: 'e', sig: '1 #', sharps: 1, flats: 0 },
            { maj: 'D', min: 'b', sig: '2 #', sharps: 2, flats: 0 },
            { maj: 'A', min: 'f#', sig: '3 #', sharps: 3, flats: 0 },
            { maj: 'E', min: 'c#', sig: '4 #', sharps: 4, flats: 0 },
            { maj: 'B', min: 'g#', sig: '5 #', sharps: 5, flats: 0 },
            { maj: 'F#', min: 'd#', sig: '6 #', sharps: 6, flats: 0 }, // Gb
            { maj: 'Db', min: 'bb', sig: '5 b', sharps: 0, flats: 5 }, // C#
            { maj: 'Ab', min: 'f', sig: '4 b', sharps: 0, flats: 4 },
            { maj: 'Eb', min: 'c', sig: '3 b', sharps: 0, flats: 3 },
            { maj: 'Bb', min: 'g', sig: '2 b', sharps: 0, flats: 2 },
            { maj: 'F', min: 'd', sig: '1 b', sharps: 0, flats: 1 }
        ];

        // Roman numerals for chords: I, ii, iii, IV, V, vi, vii°
        // We need a chromatic scale to calculate chords dynamically, but hardcoding map is safer for enharmonic spellings
        const chordMap = {
            'C': ['C', 'Dm', 'Em', 'F', 'G', 'Am', 'Bdim'],
            'G': ['G', 'Am', 'Bm', 'C', 'D', 'Em', 'F#dim'],
            'D': ['D', 'Em', 'F#m', 'G', 'A', 'Bm', 'C#dim'],
            'A': ['A', 'Bm', 'C#m', 'D', 'E', 'F#m', 'G#dim'],
            'E': ['E', 'F#m', 'G#m', 'A', 'B', 'C#m', 'D#dim'],
            'B': ['B', 'C#m', 'D#m', 'E', 'F#', 'G#m', 'A#dim'],
            'F#': ['F#', 'G#m', 'A#m', 'B', 'C#', 'D#m', 'E#dim'],
            'Db': ['Db', 'Ebm', 'Fm', 'Gb', 'Ab', 'Bbm', 'Cdim'],
            'Ab': ['Ab', 'Bbm', 'Cm', 'Db', 'Eb', 'Fm', 'Gdim'],
            'Eb': ['Eb', 'Fm', 'Gm', 'Ab', 'Bb', 'Cm', 'Ddim'],
            'Bb': ['Bb', 'Cm', 'Dm', 'Eb', 'F', 'Gm', 'Adim'],
            'F': ['F', 'Gm', 'Am', 'Bb', 'C', 'Dm', 'Edim']
        };

        function init() {
            // Draw Slices
            const cx = 200, cy = 200, rOut = 190, rIn = 120, rMid = 140;

            keys.forEach((k, i) => {
                // Angle: -90 deg is start (Top)
                // 12 slices, 30 deg each.
                // Start angle for slice i: i * 30 - 15 - 90
                const startDeg = (i * 30) - 15 - 90;
                const endDeg = startDeg + 30;

                const startRad = startDeg * Math.PI / 180;
                const endRad = endDeg * Math.PI / 180;

                // Outer Arc Points
                const x1 = cx + rOut * Math.cos(startRad);
                const y1 = cy + rOut * Math.sin(startRad);
                const x2 = cx + rOut * Math.cos(endRad);
                const y2 = cy + rOut * Math.sin(endRad);

                // Inner Arc Points
                const x3 = cx + rIn * Math.cos(endRad);
                const y3 = cy + rIn * Math.sin(endRad);
                const x4 = cx + rIn * Math.cos(startRad);
                const y4 = cy + rIn * Math.sin(startRad);

                // Path
                const d = `M ${x1} ${y1} A ${rOut} ${rOut} 0 0 1 ${x2} ${y2} L ${x3} ${y3} A ${rIn} ${rIn} 0 0 0 ${x4} ${y4} Z`;

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", d);
                path.setAttribute("fill", "#f8fafc");
                path.setAttribute("stroke", "#cbd5e1");
                path.setAttribute("class", "slice");
                path.id = `slice-${i}`;
                path.onclick = () => selectKey(i);
                svg.appendChild(path);

                // Text (Major)
                const txtAngle = (i * 30) - 90;
                const txtRad = txtAngle * Math.PI / 180;
                const txtR = 165;
                const tx = cx + txtR * Math.cos(txtRad);
                const ty = cy + txtR * Math.sin(txtRad);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", tx);
                text.setAttribute("y", ty);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("class", "key-text text-slate-700 font-bold text-lg pointer-events-none");
                text.id = `text-${i}`;
                text.textContent = k.maj;
                svg.appendChild(text);

                // Text (Minor) - Inner
                // const minR = 130;
                // const tmx = cx + minR * Math.cos(txtRad);
                // const tmy = cy + minR * Math.sin(txtRad);
                // const textMin = document.createElementNS("http://www.w3.org/2000/svg", "text");
                // textMin.setAttribute("x", tmx);
                // textMin.setAttribute("y", tmy);
                // textMin.setAttribute("text-anchor", "middle");
                // textMin.setAttribute("dominant-baseline", "middle");
                // textMin.setAttribute("class", "key-text text-slate-400 text-sm pointer-events-none");
                // textMin.textContent = k.min;
                // svg.appendChild(textMin);
            });

            // Select C
            selectKey(0);
        }

        function selectKey(index) {
            // Reset styles
            document.querySelectorAll('.slice').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.key-text').forEach(el => el.classList.remove('text-active'));

            // Set Active
            document.getElementById(`slice-${index}`).classList.add('active');
            document.getElementById(`text-${index}`).classList.add('text-active');

            const k = keys[index];

            // Update UI
            document.getElementById('center-key').innerText = k.maj;
            document.getElementById('info-minor').innerText = k.min;
            document.getElementById('info-sig').innerText = k.sig;

            const chords = chordMap[k.maj] || [];
            document.getElementById('info-chords').innerHTML = chords.map(c => `<span class="bg-white px-2 py-1 rounded border border-indigo-200 shadow-sm">${c}</span>`).join('');
        }

        init();
    </script>
</body>

</html>